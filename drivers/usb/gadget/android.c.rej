--- drivers/usb/gadget/android.c
+++ drivers/usb/gadget/android.c
@@ -3919,50 +3879,38 @@ functions_store(struct device *pdev, struct device_attribute *attr,
 		curr_conf = curr_conf->next;
 		while (conf_str) {
 			name = strsep(&conf_str, ",");
+			is_ffs = 0;
 			strlcpy(aliases, dev->ffs_aliases, sizeof(aliases));
 			a = aliases;
 
 			while (a) {
 				char *alias = strsep(&a, ",");
 				if (alias && !strcmp(name, alias)) {
-					name = "ffs";
+					is_ffs = 1;
 					break;
 				}
 			}
 
-			if (ffs_enabled && !strcmp(name, "ffs"))
-				continue;
-
-			if (hid_enabled && !strcmp(name, "hid"))
+			if (is_ffs) {
+				if (ffs_enabled)
+					continue;
+				err = android_enable_function(dev, conf, "ffs");
+				if (err)
+					pr_err("android_usb: Cannot enable ffs (%d)",
+									err);
+				else
+					ffs_enabled = 1;
 				continue;
+			}
 
 			if (!strcmp(name, "rndis") &&
 				!strcmp(strim(rndis_transports), "BAM2BAM_IPA"))
 				name = "rndis_qc";
 
 			err = android_enable_function(dev, conf, name);
-			if (err) {
-				pr_err("android_usb: Cannot enable '%s' (%d)",
-							name, err);
-				continue;
-			}
-
-			if (!strcmp(name, "ffs"))
-				ffs_enabled = 1;
-
-			if (!strcmp(name, "hid"))
-				hid_enabled = 1;
-		}
-
-		/* Always enable HID gadget function. */
-		if (!hid_enabled) {
-			name = "hid";
-			err = android_enable_function(dev, conf, name);
 			if (err)
 				pr_err("android_usb: Cannot enable '%s' (%d)",
 							name, err);
-			else
-				hid_enabled = 1;
 		}
 	}
 
